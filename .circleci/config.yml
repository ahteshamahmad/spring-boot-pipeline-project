version: 2.1
jobs:
  build-and-deploy:
    docker:
      - image: circleci/openjdk:11

    steps:
      - checkout
      - setup_remote_docker:
          version: 20.10.7
          docker_layer_caching: true

      # Build Docker image
      - run:
          name: Build Docker image
          command: |
            docker build -t kubernetes-docker-image .

      # Push Docker image to a container registry
      - run:
          name: Push Docker image
          command: |
            echo "$realme@1234" | docker login --username "$ahteshamdocker" --password-stdin
            docker push ahteshamdocker/kubernetes-docker-image

      # Deploy to Kubernetes
      - run:
          name: Deploy to Kubernetes
          command: |
            kubectl apply -f database.yaml

workflows:
  version: 2
  build-and-deploy:
    jobs:
      - build-and-deploy

